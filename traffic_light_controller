
import time
from machine import UART

uart = UART(2, baudrate=9600, tx=16, rx=17)

def sendAvailableSlots(slots, color, direction):
    if slots == "GO":
        message = f'|C|1|4|1|28-0-#{direction}#{color}GO|'
    elif slots == "STOP":
        message = f'|C|1|4|1|28-0-#{color}STOP|'  # Removed the direction for STOP
    else:
        slots_str = f'{slots:02d}'
        message = f'|C|1|4|1|28-0-#{direction}#{color}{slots_str}|'
    print(f"Sending message: {message}")
    uart.write(message.encode('ascii'))

def traffic_light_controller():
    while True:
        # Red light
        countdown = 30
        while countdown > 0:
            sendAvailableSlots(countdown, 'R', 'u')  # Send countdown as available slots with red color and up arrow
            time.sleep(1)
            countdown -= 1
        
        # Red + yellow light (transition)
        countdown = 4
        while countdown > 0:
            sendAvailableSlots("GO", 'G', 'u')  # Send "GO" message with green color and up arrow
            time.sleep(1)
            countdown -= 1
        
        # Green light
        countdown = 50
        while countdown > 0:
            sendAvailableSlots(countdown, 'G', 'u')  # Send countdown as available slots with green color and up arrow
            time.sleep(1)
            countdown -= 1
        
        # Yellow light
        countdown = 4
        while countdown > 0:
            sendAvailableSlots("STOP", 'R', None)  # Send "STOP" message with red color and no arrow
            time.sleep(1)
            countdown -= 1

# Call the traffic_light_controller() function directly
traffic_light_controller()
